<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <title>Covid19 Puzzle</title>

    <!-- Bootstrap core CSS -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />

    <!-- font -->
    <link
      href="https://fonts.googleapis.com/css?family=Raleway"
      rel="stylesheet"
    />

    <!-- Custom styles for this template -->
    <link href="css/puzzle.css" rel="stylesheet" />
  </head>

  <body>
    <!-- Navigation -->
    <div class="container-fluid mt-5">
      <h1 class="title">COVID-19 PUZZLE</h1>

      <div class="row mb-5 mt-5">
        <div class="col-lg-2 my-auto">
          <div class="w-100 h-100 d-flex justify-content-center">
            <div class="image-preview d-flex align-items-center">
              <div class="d-flex flex-column">
                <img src="images/Social-Distancing/image.png" alt="image" />
                <div class="image-preview-button d-flex">
                  <button type="button" class="btn btn-primary"><</button>
                  <button type="button" class="btn btn-primary">></button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- puzzle image -->
        <div class="col-lg-5 my-auto">
          <div style="text-align: center">
            <div style="">
              <h1 id="message"></h1>
            </div>
            <div style="">
              <h1 id="moves">Moves</h1>

              <audio
                id="cheers"
                controls="none"
                preload="auto"
                style="display: none"
              >
                <source src="aud.mp3" type="audio/mp3" />
              </audio>

              <audio
                id="cut"
                controls="none"
                preload="auto"
                style="display: none"
              >
                <source src="cut.mp4" type="audio/mp4" />
              </audio>

              <audio
                id="no"
                controls="none"
                preload="auto"
                style="display: none"
              >
                <source src="no.mp4" type="audio/mp4" />
              </audio>
            </div>

            <div class="image-puzzle">
              <!-- <canvas id="canvas" height="450px" width="450px"></canvas> -->
              <div class="tiles">
                <div class="tile img0" style="left: 0px; top: 0px">
                  <img
                    class="picture"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
                <div class="tile img1" style="left: 150px; top: 0px">
                  <img
                    class="picture"
                    style="transform: translate(-150px, 0)"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
                <div class="tile img2" style="left: 300px; top: 0px">
                  <img
                    class="picture"
                    style="transform: translate(-300px, 0)"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
                <div class="tile img3" style="left: 0px; top: 150px">
                  <img
                    class="picture"
                    style="transform: translate(0, -150px)"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
                <div class="tile img4" style="left: 150px; top: 150px">
                  <img
                    class="picture"
                    style="transform: translate(-150px, -150px)"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
                <div class="tile img5" style="left: 300px; top: 150px">
                  <img
                    class="picture"
                    style="transform: translate(-300px, -150px)"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
                <div class="tile img6" style="left: 0px; top: 300px">
                  <img
                    class="picture"
                    style="transform: translate(0, -300px)"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
                <div class="tile img7" style="left: 150px; top: 300px">
                  <img
                    class="picture"
                    style="transform: translate(-150px, -300px)"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
                <div class="tile img8" style="left: 300px; top: 300px">
                  <img
                    class="picture"
                    style="transform: translate(-450px, -450px)"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- original image -->
        <div class="col-lg-5 my-auto">
          <div style="text-align: center">
            <div style="">
              <h1 id="message_ai"></h1>
            </div>
            <div style="">
              <h1 id="moves_ai">Moves</h1>
            </div>

            <div class="image-puzzle">
              <div class="tiles">
                <div class="tile img_ai0" style="left: 0px; top: 0px">
                  <img
                    class="picture"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
                <div class="tile img_ai1" style="left: 150px; top: 0px">
                  <img
                    class="picture"
                    style="transform: translate(-150px, 0)"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
                <div class="tile img_ai2" style="left: 300px; top: 0px">
                  <img
                    class="picture"
                    style="transform: translate(-300px, 0)"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
                <div class="tile img_ai3" style="left: 0px; top: 150px">
                  <img
                    class="picture"
                    style="transform: translate(0, -150px)"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
                <div class="tile img_ai4" style="left: 150px; top: 150px">
                  <img
                    class="picture"
                    style="transform: translate(-150px, -150px)"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
                <div class="tile img_ai5" style="left: 300px; top: 150px">
                  <img
                    class="picture"
                    style="transform: translate(-300px, -150px)"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
                <div class="tile img_ai6" style="left: 0px; top: 300px">
                  <img
                    class="picture"
                    style="transform: translate(0, -300px)"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
                <div class="tile img_ai7" style="left: 150px; top: 300px">
                  <img
                    class="picture"
                    style="transform: translate(-150px, -300px)"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
                <div class="tile img_ai8" style="left: 300px; top: 300px">
                  <img
                    class="picture"
                    style="transform: translate(-450px, -450px)"
                    src="https://cdn.mos.cms.futurecdn.net/VSy6kJDNq2pSXsCzb6cvYF.jpg"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Knowledge Message -->
      <div class="row justify-content-end">
        <div class="col-lg-10">
          <div class="d-flex justify-content-center">
            <div class="w-75 card text-white bg-dark mb-3">
              <div class="card-header">For your information</div>
              <div class="card-body">
                <h5 class="card-title">Lockdown</h5>
                <p class="card-text">
                  Lockdown merupakan kondisi di mana orang-orang tak boleh
                  keluar dan masuk pada suatu daerah.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap core JavaScript -->
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>

    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>

    <script src="./algo/search-solution.js"></script>
    <script src="./algo/arr_helper.js"></script>

    <script>
      var normArr = [0,1,2,3,4,5,6,7,8]
      var imgObject = {
        emptyPos:9,
        restart:0,
        moves:-1,
        imgArr:[],
        identifier:"img"
      }

      var imgObjectAI = {
        emptyPos:9,
        restart:0,
        moves:-1,
        imgArr:[],
        identifier:"img_ai"
      }

      class PlayGround {
        constructor(imgArr, moves, emptyPos, restart, identifier) {
          this.imgArr = imgArr
          this.moves = imgArr
          this.imgArr = imgArr
          this.imgArr = imgArr
          this.imgArr = imgArr
        }
      }

      function won() {
        var img = document.getElementsByClassName("img8")[0];
        img.style.top = "300px"
        img.style.left = "300px"
        imgInner = img.childNodes[1]
        imgInner.style.transform = "translate(-300px, -300px)";
        message = document.getElementById("message");
        message.innerHTML =
          "You won the game in " + moves.toString() + " moves";
        au = document.getElementById("cheers");
        au.play();
        restart = 1;
        moves = -1;
        console.log("finish WON")
      }

      function restartProp() {
        var img = document.getElementsByClassName("img8")[0];
        imgInner = img.childNodes[1]
        imgInner.style.transform = "translate(-450px, -450px)";
        message = document.getElementById("message");
        message.innerHTML='';
      }

      // plotting random image and still checking is it win and still move component one by one
      function draw(imageObject) {
        imageObject.moves++
        console.log(`solvable kah? ${isSolvable(im)}`)
        mov = document.getElementById("moves");
        mov.innerHTML = "MOVES: " + imageObject.moves.toString();
        let isDiff;
        isDiff = 0;
        if (imageObject.restart == 1) {
          im = shuffle([...normArr]);
          for (var i = 0; i <= 8; i++) {
            if (im[i] == 8) emptyPos = i + 1;
          }
          console.log(emptyPos);
          restart = 0;
          restartProp()
        }
        for (var i = 0; i < 9; i++) {
          if (im[i] != normArr[i]) isDiff = 1;
        }
        console.log(`diff position ${im}`);
        console.log(normArr);

        for (var i = 0; i < 3; i++) {
          for (var j = 0; j < 3; j++) {
            component(i, j);
          }
        }

        console.log(isDiff);

        if (isDiff == 0) {
          console.log("congrats");
          setTimeout(function(){
            won();
          }, 1000)
        }
      }

      function component(x, y, image) {
        let text = "img";
        let indexArr = x + 3 * y;
        let imgPart = im[indexArr];
        text = text + imgPart.toString();
        // console.log(`textnya ${text}`);
        let img = document.getElementsByClassName(text)[0];
        img.style.left = 150 * x + "px";
        img.style.top = 150 * y + "px";
      }

      function moveup() {
        if (restart == 1) {
          draw();
        } else if (emptyPos == 9 || emptyPos == 7 || emptyPos == 8) {
          au = document.getElementById("no");
          au.play();
        } else {
          au = document.getElementById("cut");
          au.play();
          var curr = emptyPos;
          emptyPos = emptyPos + 3;
          var next = emptyPos;
          im[curr - 1] = im[next - 1];
          im[next - 1] = 8;
          draw();
        }
        console.log(emptyPos);
      }

      function movedown() {
        if (restart == 1) {
          draw();
        } else if (emptyPos == 1 || emptyPos == 2 || emptyPos == 3) {
          au = document.getElementById("no");
          au.play();
        } else {
          au = document.getElementById("cut");
          au.play();
          let curr = emptyPos;
          emptyPos = emptyPos - 3;
          let next = emptyPos;
          im[curr - 1] = im[next - 1];
          im[next - 1] = 8;
          draw();
        }
        console.log(emptyPos);
      }

      function moveleft() {
        if (restart == 1) {
          draw();
        } else if (emptyPos == 6 || emptyPos == 9 || emptyPos == 3) {
          au = document.getElementById("no");
          au.play();
        } else {
          au = document.getElementById("cut");
          au.play();
          var curr = emptyPos;
          emptyPos = emptyPos + 1;
          var next = emptyPos;
          im[curr - 1] = im[next - 1];
          im[next - 1] = 8;
          draw();
        }
        console.log(emptyPos);
      }

      function moveright() {
        if (restart == 1) {
          draw();
        } else if (emptyPos == 1 || emptyPos == 4 || emptyPos == 7) {
          au = document.getElementById("no");
          au.play();
        } else {
          au = document.getElementById("cut");
          au.play();
          var curr = emptyPos;
          emptyPos = emptyPos - 1;
          var next = emptyPos;
          im[curr - 1] = im[next - 1];
          im[next - 1] = 8;
          draw();
        }
        console.log(emptyPos);
      }

      //program start
      function start() {
        let tempShuffledArr = shuffle([...normArr])
        while (!isSolvable(tempShuffledArr)) {
          tempShuffledArr = shuffle([...normArr])
        }
        imgObject.imgArr = [...tempShuffledArr]
        imgObjectAI.imgArr = [...tempShuffledArr]
        for (var i = 0; i <= 8; i++) {
          if (im[i] == 8) {
            imgObject.emptyPos = i + 1;
            imgObjectAI.emptyPos = i + 1;
          }
        }
        draw(imgObject)
        draw(imgObjectAI)
      }

      window.addEventListener("keydown", function (e) {
        key = e.keyCode;
        if (key == 37) {
          e.preventDefault();
          moveleft();
        }
        if (key == 38) {
          e.preventDefault();
          moveup();
        }
        if (key == 39) {
          e.preventDefault();
          moveright();
        }
        if (key == 40) {
          e.preventDefault();
          movedown();
        }
        if (key == 83) {
          e.preventDefault();
          console.log("searching nowie")
          // start();
          var result = search(im);
          // console.log(result)
          // runSolution(result, result.pathCost)
        }
      });

      function runSolution(goalState, counter) {
        if (goalState == null) {
          return;
        } else {
          let subtracted = counter-1
          runSolution(goalState.previous, subtracted);
          // i = 0
          // while (i < 10) {
          //   // console.log(i)
          //   i++
          // }
          setTimeout(function() {
            console.log(counter)
            console.log(goalState)
            im = goalState.tiles;
            draw();
          }, 400*counter)
          // console.log(im)
          // console.log(`counternya ${counter}`);
          // return; 
          // console.log(goalState.action);
        }
      }

      function helo() {
        console.log(`SAY HELLO ${im}`)
      }
      // ctx.font = "30px Arial";
      // ctx.fillText("Hit S to start the game", 80, 210);
    </script>
  </body>
</html>
